{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://lifeos.com/schemas/instrument_spec/1-0-0.json",
  "title": "Instrument Spec",
  "description": "Schema for instrument definitions (questionnaires, scales, etc.)",
  "type": "object",
  "required": ["type", "instrument_id", "version", "name", "kind", "items", "scales"],
  "properties": {
    "type": {
      "type": "string",
      "const": "instrument_spec"
    },
    "instrument_id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_]*$",
      "description": "Unique identifier for the instrument (lowercase, underscore-separated)"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "SemVer version string"
    },
    "name": {
      "type": "string",
      "description": "Human-readable name of the instrument"
    },
    "kind": {
      "type": "string",
      "enum": ["questionnaire", "scale", "inventory", "checklist"],
      "description": "Type of instrument"
    },
    "locale": {
      "type": "string",
      "pattern": "^[a-z]{2}-[A-Z]{2}$",
      "description": "Locale code (e.g., en-US)"
    },
    "aliases": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Alternative names for the instrument"
    },
    "description": {
      "type": "string",
      "description": "Description of the instrument"
    },
    "items": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["item_id", "position", "text", "response_map"],
        "properties": {
          "item_id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Unique item identifier within the instrument"
          },
          "position": {
            "type": "integer",
            "minimum": 1,
            "description": "Item position in the instrument (1-indexed)"
          },
          "text": {
            "type": "string",
            "description": "Item text/question"
          },
          "response_map": {
            "type": "object",
            "additionalProperties": { "type": "integer" },
            "description": "Map of response text to numeric value"
          },
          "aliases": {
            "type": "object",
            "additionalProperties": { "type": "string" },
            "description": "Map of alias text to canonical response text"
          }
        }
      }
    },
    "scales": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["scale_id", "name", "items", "method", "interpretations"],
        "properties": {
          "scale_id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Unique scale identifier"
          },
          "name": {
            "type": "string",
            "description": "Human-readable scale name"
          },
          "items": {
            "type": "array",
            "items": { "type": "string" },
            "description": "List of item_ids included in this scale"
          },
          "method": {
            "type": "string",
            "enum": ["sum", "average", "sum_then_double"],
            "description": "Scoring method"
          },
          "reversed_items": {
            "type": "array",
            "items": { "type": "string" },
            "description": "List of item_ids that are reverse-scored"
          },
          "min": {
            "type": "integer",
            "description": "Minimum possible score"
          },
          "max": {
            "type": "integer",
            "description": "Maximum possible score"
          },
          "missing_allowed": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of missing items allowed before score is invalid"
          },
          "interpretations": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["min", "max", "label"],
              "properties": {
                "min": {
                  "type": "integer",
                  "description": "Minimum score for this range (inclusive)"
                },
                "max": {
                  "type": "integer",
                  "description": "Maximum score for this range (inclusive)"
                },
                "label": {
                  "type": "string",
                  "description": "Interpretation label (e.g., 'Mild', 'Moderate')"
                },
                "severity": {
                  "type": "integer",
                  "description": "Numeric severity level"
                },
                "description": {
                  "type": "string",
                  "description": "Detailed description of this interpretation"
                }
              }
            }
          }
        }
      }
    }
  }
}
